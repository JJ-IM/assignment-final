<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌÇπÏΩ©Î®∏Îãà üí∏ - Í∏∞Î°ù</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/main/DK_icon.ico">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/AfterMain.css">
    <link rel="stylesheet" href="../css/History.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <video autoplay loop muted playsinline id="bg-video" style="filter: blur(3px);">
        <source src="../assets/video/Red_Smok.mp4" type="video/mp4">
    </video>

    <div id="content">
        <!-- Ïù¥Í≥≥Ïóê JavaScriptÏóê ÏùòÌï¥ Ïª®ÌÖêÏ∏†Í∞Ä Î°úÎìúÎê©ÎãàÎã§. -->
    </div>

    <script>
        // Ïø†ÌÇ§Î•º ÏùΩÎäî Ìï®Ïàò
        function getCookie(name) {
            let value = "; " + document.cookie;
            let parts = value.split("; " + name + "=");
            if (parts.length == 2) return parts.pop().split(";").shift();
        }

        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÎ•º ÌôïÏù∏ÌïòÎäî Ìï®Ïàò
        function checkLogin() {
            return getCookie("username") !== undefined;
        }

        // Ïª®ÌÖêÏ∏† Î°úÎìú Ìï®Ïàò
        function loadContent() {
            const contentDiv = document.getElementById('content');
            if (1) {
                // Î°úÍ∑∏Ïù∏Îêú ÏÉÅÌÉú
                contentDiv.innerHTML = `
                    <div class="afterMain-container">
                        <div class="afterMain-box">
                            <div class="afterNav-box">
                                <div class="afterLogo">
                                    <img src="../assets/img/main/BlackJack.png" alt="BJ_Logo" class="afterLogo-img clickable-img" id="blackjack-logo">
                                </div>
                                <div class="afterMenu">
                                    <div class="button-wrapper">
                                        <a href="./Ranking.html" class="button">
                                            <img src="../assets/img/navbar/Ranking.svg" alt="Ranking" class="button-icon">
                                            <span class="button-text"> Îû≠ÌÇπ </span>
                                        </a>
                                    </div>
                                    <div class="button-wrapper">
                                        <a href="./History.html" class="button clicked">
                                            <img src="../assets/img/navbar/History.svg" alt="History" class="button-icon">
                                            <span class="button-text"> Í∏∞Î°ù </span>
                                        </a>
                                    </div>
                                    <div class="button-wrapper">
                                        <a href="./Play.html" class="button">
                                            <img src="../assets/img/navbar/Play.svg" alt="Play" class="button-icon">
                                            <span class="button-text"> ÏãúÏûë </span>
                                        </a>
                                    </div>
                                    <div class="button-wrapper">
                                        <a href="./Mypage.html" class="button">
                                            <img src="../assets/img/navbar/Mypage.svg" alt="Mypage" class="button-icon">
                                            <span class="button-text"> Ï†ïÎ≥¥ </span>
                                        </a>
                                    </div>
                                </div>
                                <div class="afterUser">
                                    <div class="afterProfile">
                                        <img src="../assets/img/main/userPro.png" alt="Profile" class="afterProfile-img">
                                    </div>
                                    <div class="afterUserdata">
                                        <div class="user-name">
                                            ${getCookie("username")}
                                        </div>
                                        <div class="user-coins">
                                            <img src="../assets/img/main/Coin.png" alt="coinsImg" class="afterCoins-img">
                                            <div class="coins-info">
                                                ${getCookie("coins") ? getCookie("coins").slice(0, 5) : "err.."}
                                            </div>
                                            <div class="afterCoinsPlus">
                                                <img src="../assets/img/navbar/Plus.svg" alt="coinsPlus" class="afterCoinsPlus-svg clickable-img" id="go-to-shop">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="afterContent-box">
                                <div class="title-box">
                                    <h2 class="top-title">History</h2>
                                </div>
                                <div class="content-box">
                                    <div class="history-summary">
                                        <div class="summary-box">
                                            <div class="summary-title">Ï†ÑÌåê Í≤åÏûÑ</div>
                                            <div id="last-game" class="summary-value">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>
                                        </div>
                                        <div class="summary-box">
                                            <div class="summary-title">ÏµúÍ∑º ÏäπÎ•†</div>
                                            <div id="recent-win-rate" class="summary-value">0%</div>
                                        </div>
                                        <div class="summary-box">
                                            <div class="summary-title">Ï†ÑÏ≤¥ ÏäπÎ•†</div>
                                            <div id="overall-win-rate" class="summary-value">0%</div>
                                        </div>
                                    </div>
                                    <div class="history-header">
                                        <div>Ìåê Ïàò</div>
                                        <div>Í≤∞Í≥º</div>
                                        <div></div>
                                    </div>
                                    <div class="history-list-container">
                                        <ul id="history-list" class="history-list"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('blackjack-logo').addEventListener('click', function() {
                    window.location.href = '../';
                });
                document.getElementById('go-to-shop').addEventListener('click', function() {
                    window.location.href = './Shop.html';
                });
                loadHistory();
            } else {
                alert("Î°úÍ∑∏Ïù∏ÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî");
                window.location.href = '../';
            }
        }

        // Í≤åÏûÑ Í∏∞Î°ù Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ìï®Ïàò
        function loadHistory() {
            fetch('http://m.colio.net:8888/acc/getHistory')
                .then(response => response.json())
                .then(data => {
                    renderHistoryData(data);
                })
                .catch(error => {
                    console.error('Error fetching history data:', error);
                    // ÏóêÎü¨ Î∞úÏÉù Ïãú ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.
                    const dummyData = [
                        'Lose', 'Draw', 'Lose', 'Win', 'Draw', 'Lose', 'Win', 'Draw', 'Lose', 'Win'
                    ];
                    renderHistoryData(dummyData);
                });
        }

        function renderHistoryData(data) {
            const historyList = document.getElementById('history-list');
            const lastGameElement = document.getElementById('last-game');
            const recentWinRateElement = document.getElementById('recent-win-rate');
            const overallWinRateElement = document.getElementById('overall-win-rate');

            // Îç∞Ïù¥ÌÑ∞Í∞Ä 10Í∞ú Ïù¥ÌïòÏù∏ Í≤ΩÏö∞, ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞ÄÌï©ÎãàÎã§.
            const dummyData = [
                'Win', 'Draw', 'Lose', 'Win', 'Draw', 'Lose', 'Win', 'Draw', 'Lose', 'Win'
            ];
            while (data.length < 10) {
                data.push(dummyData[data.length % dummyData.length]);
            }

            // Í∞ÄÏû• ÏµúÍ∑º Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞
            const lastGame = data[0];
            lastGameElement.textContent = lastGame === 'Win' ? 'ÏäπÎ¶¨' : lastGame === 'Lose' ? 'Ìå®Î∞∞' : 'Î¨¥ÏäπÎ∂Ä';

            // ÏµúÍ∑º 5Í≤åÏûÑÏùò ÏäπÎ•† Í≥ÑÏÇ∞
            const recentGames = data.slice(0, 5);
            const recentWins = recentGames.filter(result => result === 'Win').length;
            const recentWinRate = Math.round((recentWins / recentGames.length) * 100);
            recentWinRateElement.textContent = `${recentWinRate}%`;

            // Ï†ÑÏ≤¥ Í≤åÏûÑÏùò ÏäπÎ•† Í≥ÑÏÇ∞
            const totalGames = data.length;
            const totalWins = data.filter(result => result === 'Win').length;
            const overallWinRate = Math.round((totalWins / totalGames) * 100);
            overallWinRateElement.textContent = `${overallWinRate}%`;

            // ÌûàÏä§ÌÜ†Î¶¨ Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±
            data.forEach((result, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('history-item');
                listItem.innerHTML = `
                    <div class="history-game-number">${data.length - index}</div>
                    <div class="history-result-box">
                        <div class="history-result win ${result === 'Win' ? 'highlight' : ''}">ÏäπÎ¶¨</div>
                        <div class="history-result draw ${result === 'Draw' ? 'highlight' : ''}">Î¨¥ÏäπÎ∂Ä</div>
                        <div class="history-result lose ${result === 'Lose' ? 'highlight' : ''}">Ìå®Î∞∞</div>
                    </div>
                `;
                historyList.appendChild(listItem);
            });
        }

        window.onload = loadContent;
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>

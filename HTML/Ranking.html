<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>킹콩머니 💸 - 랭킹</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/main/DK_icon.ico">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/AfterMain.css">
    <link rel="stylesheet" href="../css/Ranking.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <video autoplay loop muted playsinline id="bg-video" style="filter: blur(3px);">
        <source src="../assets/video/Red_Smok.mp4" type="video/mp4">
    </video>

    <div id="content">
        <!-- 이곳에 JavaScript에 의해 컨텐츠가 로드됩니다. -->
    </div>

    <script>
        // 쿠키를 읽는 함수
        function getCookie(name) {
            let value = "; " + document.cookie;
            let parts = value.split("; " + name + "=");
            if (parts.length == 2) return parts.pop().split(";").shift();
        }

        // 로그인 상태를 확인하는 함수
        function checkLogin() {
            return getCookie("username") !== undefined;
        }

        // 컨텐츠 로드 함수
        function loadContent() {
            const contentDiv = document.getElementById('content');
            if (1) {
                // 로그인된 상태
                contentDiv.innerHTML = `
                    <div class="afterMain-container">
                        <div class="afterMain-box">
                            <div class="afterNav-box">
                                <div class="afterLogo">
                                    <img src="../assets/img/main/BlackJack.png" alt="BJ_Logo" class="afterLogo-img clickable-img" id="blackjack-logo">
                                </div>
                                <div class="afterMenu">
                                    <div class="button-wrapper">
                                        <a href="./Ranking.html" class="button clicked">
                                            <img src="../assets/img/navbar/Ranking.svg" alt="Ranking" class="button-icon">
                                            <span class="button-text"> 랭킹 </span>
                                        </a>
                                    </div>
                                    <div class="button-wrapper">
                                        <a href="./History.html" class="button">
                                            <img src="../assets/img/navbar/History.svg" alt="History" class="button-icon">
                                            <span class="button-text"> 기록 </span>
                                        </a>
                                    </div>
                                    <div class="button-wrapper">
                                        <a href="./Play.html" class="button">
                                            <img src="../assets/img/navbar/Play.svg" alt="Play" class="button-icon">
                                            <span class="button-text"> 시작 </span>
                                        </a>
                                    </div>
                                    <div class="button-wrapper">
                                        <a href="./Mypage.html" class="button">
                                            <img src="../assets/img/navbar/Mypage.svg" alt="Mypage" class="button-icon">
                                            <span class="button-text"> 정보 </span>
                                        </a>
                                    </div>
                                </div>
                                <div class="afterUser">
                                    <div class="afterProfile">
                                        <img src="../assets/img/main/userPro.png" alt="Profile" class="afterProfile-img">
                                    </div>
                                    <div class="afterUserdata">
                                        <div class="user-name">
                                            ${getCookie("username")}
                                        </div>
                                        <div class="user-coins">
                                            <img src="../assets/img/main/Coin.png" alt="coinsImg" class="afterCoins-img">
                                            <div class="coins-info">
                                                ${getCookie("coins") ? getCookie("coins").slice(0, 5) : "err.."}
                                            </div>
                                            <div class="afterCoinsPlus">
                                                <img src="../assets/img/navbar/Plus.svg" alt="coinsPlus" class="afterCoinsPlus-svg clickable-img" id="go-to-shop">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="afterContent-box">
                                <div class="title-box">
                                    <h2 class="top-title">Ranking</h2>
                                </div>
                                <div class="content-box">
                                    <div class="ranking-header">
                                        <div class="rank">순위</div>
                                        <div class="nickname">닉네임</div>
                                        <div class="total-match">판수</div>
                                        <div class="total-win">승리 횟수</div>
                                        <div class="total-lose">패배 횟수</div>
                                    </div>
                                    <div class="ranking-list-container">
                                        <ul id="ranking-list" class="ranking-list"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('blackjack-logo').addEventListener('click', function() {
                    window.location.href = '../';
                });
                document.getElementById('go-to-shop').addEventListener('click', function() {
                    window.location.href = './Shop.html';
                });
                loadRanking();
            } else {
                alert("로그인을 해주세요");
                window.location.href = '../';
            }
        }

        // 랭킹 데이터를 불러오는 함수
        function loadRanking() {
            fetch('http://m.colio.net:8888/acc/getRank')
                .then(response => response.json())
                .then(data => {
                    const rankingList = document.getElementById('ranking-list');
                    const dummyData = [
                        { nickname: '더미', totalMatch: -1, totalWin: -1, totalLose: -1 },
                        { nickname: '더미', totalMatch: -2, totalWin: -2, totalLose: -2 },
                        { nickname: '더미', totalMatch: -3, totalWin: -3, totalLose: -3 },
                        { nickname: '더미', totalMatch: -4, totalWin: -4, totalLose: -4 },
                        { nickname: '더미', totalMatch: -5, totalWin: -5, totalLose: -5 },
                        { nickname: '더미', totalMatch: -6, totalWin: -6, totalLose: -6 },
                        { nickname: '더미', totalMatch: -7, totalWin: -7, totalLose: -7 },
                        { nickname: '더미', totalMatch: -8, totalWin: -8, totalLose: -8 },
                        { nickname: '더미', totalMatch: -9, totalWin: -9, totalLose: -9 },
                        { nickname: '더미', totalMatch: -10, totalWin: -10, totalLose: -10 },
                        { nickname: '더미', totalMatch: -11, totalWin: -11, totalLose: -11 }
                    ];

                    // 서버에서 데이터를 받아오지 못한 경우, 더미 데이터를 사용합니다.
                    if (!data || data.length === 0) {
                        data = dummyData;
                    }

                    // 데이터가 10개 이하인 경우, 더미 데이터를 추가합니다.
                    while (data.length < 10) {
                        data.push(dummyData[data.length % dummyData.length]);
                    }

                    data.forEach((rank, index) => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('ranking-item');
                        listItem.innerHTML = `
                            <div class="rank">${index + 1}</div>
                            <div class="nickname">${rank.nickname}</div>
                            <div class="total-match">${rank.totalMatch}</div>
                            <div class="total-win">${rank.totalWin}</div>
                            <div class="total-lose">${rank.totalLose}</div>
                        `;
                        rankingList.appendChild(listItem);
                    });
                })
                .catch(error => {
                    console.error('Error fetching ranking data:', error);
                    // 에러 발생 시 더미 데이터를 사용합니다.
                    const rankingList = document.getElementById('ranking-list');
                    const dummyData = [
                        { nickname: '더미', totalMatch: -1, totalWin: -1, totalLose: -1 },
                        { nickname: '더미', totalMatch: -2, totalWin: -2, totalLose: -2 },
                        { nickname: '더미', totalMatch: -3, totalWin: -3, totalLose: -3 },
                        { nickname: '더미', totalMatch: -4, totalWin: -4, totalLose: -4 },
                        { nickname: '더미', totalMatch: -5, totalWin: -5, totalLose: -5 },
                        { nickname: '더미', totalMatch: -6, totalWin: -6, totalLose: -6 },
                        { nickname: '더미', totalMatch: -7, totalWin: -7, totalLose: -7 },
                        { nickname: '더미', totalMatch: -8, totalWin: -8, totalLose: -8 },
                        { nickname: '더미', totalMatch: -9, totalWin: -9, totalLose: -9 },
                        { nickname: '더미', totalMatch: -10, totalWin: -10, totalLose: -10 },
                        { nickname: '더미', totalMatch: -11, totalWin: -11, totalLose: -11 }
                    ];

                    dummyData.forEach((rank, index) => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('ranking-item');
                        listItem.innerHTML = `
                            <div class="rank">${index + 1}</div>
                            <div class="nickname">${rank.nickname}</div>
                            <div class="total-match">${rank.totalMatch}</div>
                            <div class="total-win">${rank.totalWin}</div>
                            <div class="total-lose">${rank.totalLose}</div>
                        `;
                        rankingList.appendChild(listItem);
                    });
                });
        }

        window.onload = loadContent;
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>
